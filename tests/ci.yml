.snippets:
  before_script:
    - git clone --depth 1 --branch v3.12.0 https://github.com/nlohmann/json.git
    - export JSON_ROOT=$(pwd)/json/single_include/
    - git clone --depth 1 https://github.com/Xilinx/HLS_arbitrary_Precision_Types.git
    - export XILINX_AP_INCLUDE=$(pwd)/HLS_arbitrary_Precision_Types/include
    - pip uninstall -y conifer
    - pip install -r dev_requirements.txt
    - pip install .

.pytest:
  stage: test
  script:
    - cd tests
    - pytest $PYTESTFILE -rA
  artifacts:
    when: always
    paths:
      - tests/prj*

.pytest-plain:
  extends: .pytest
  image: gitlab-registry.cern.ch/ssummers/conifer:latest
  tags:
    - k8s-default
  before_script:
    - pip uninstall -y conifer

.pytest-fpga:
  extends: .pytest
  image: registry.cern.ch/ci4fpga/vivado:2024.1
  tags:
    - fpga-mid
  before_script:
    - !reference [.snippets, before_script]